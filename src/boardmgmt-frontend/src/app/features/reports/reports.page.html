<app-page-header title="Reports &amp; Analytics">
  <div pageHeaderActions class="btn-toolbar mb-2 mb-md-0">
    <div class="btn-group me-2">
      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#reportGeneratorModal">
        <i class="fas fa-plus"></i> Generate Report
      </button>
      <button type="button" class="btn btn-outline-secondary" (click)="exportData()">
        <i class="fas fa-download"></i> Export Data
      </button>
    </div>
    <app-user-menu [displayName]="'John Doe'" (logout)="onLogout()"></app-user-menu>
  </div>
</app-page-header>

<!-- Report Categories -->
<div class="row mb-4">
  <div class="col-lg-3 col-md-6 mb-4">
    <div class="card report-category" (click)="showReports('attendance')">
      <div class="card-body text-center">
        <i class="fas fa-user-check fa-3x text-primary mb-3"></i>
        <h5 class="card-title">Attendance Reports</h5>
        <p class="card-text">Meeting attendance and participation analytics</p>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6 mb-4">
    <div class="card report-category" (click)="showReports('voting')">
      <div class="card-body text-center">
        <i class="fas fa-vote-yea fa-3x text-success mb-3"></i>
        <h5 class="card-title">Voting Analytics</h5>
        <p class="card-text">Voting patterns and decision analysis</p>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6 mb-4">
    <div class="card report-category" (click)="showReports('documents')">
      <div class="card-body text-center">
        <i class="fas fa-file-chart-line fa-3x text-warning mb-3"></i>
        <h5 class="card-title">Document Usage</h5>
        <p class="card-text">Document access and sharing statistics</p>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6 mb-4">
    <div class="card report-category" (click)="showReports('performance')">
      <div class="card-body text-center">
        <i class="fas fa-chart-line fa-3x text-info mb-3"></i>
        <h5 class="card-title">Performance Metrics</h5>
        <p class="card-text">Board effectiveness and efficiency metrics</p>
      </div>
    </div>
  </div>
</div>

<ng-template #loading>
  <div class="text-muted">Loading dashboardâ€¦</div>
</ng-template>

<!-- Charts -->
<div class="row mb-4" *ngIf="data() as d; else loading">
  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header text-white" style="background: linear-gradient(45deg,#2c3e50,#2980b9);">
        <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Meeting Attendance (Last 6 Months)</h5>
      </div>
      <div class="card-body" style="height: 320px;">
        <ng-container *ngIf="d.attendance?.length; else noAttendance">
          <canvas #attendanceCanvas style="height:100%; width:100%"></canvas>
        </ng-container>
        <ng-template #noAttendance>
          <div class="text-muted d-flex h-100 align-items-center justify-content-center">
            No attendance data.
          </div>
        </ng-template>
      </div>
    </div>
  </div>

  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header text-white" style="background: linear-gradient(45deg,#2c3e50,#2980b9);">
        <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Voting Participation Trends</h5>
      </div>
      <div class="card-body" style="height: 320px;">
        <ng-container *ngIf="d.voting?.length; else noVoting">
          <canvas #votingCanvas style="height:100%; width:100%"></canvas>
        </ng-container>
        <ng-template #noVoting>
          <div class="text-muted d-flex h-100 align-items-center justify-content-center">
            No voting data.
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<!-- Recent Reports -->
<div class="row" *ngIf="data() as d">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-history me-2"></i>Recent Reports</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Report Name</th>
                <th>Type</th>
                <th>Generated</th>
                <th>Generated By</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let r of d.recent">
                <td>
                  <strong>{{ r.name }}</strong><br />
                  <small class="text-muted">{{ r.periodLabel || '' }}</small>
                </td>
                <td>
                  <span class="badge bg-primary" *ngIf="r.type==='performance'">Performance</span>
                  <span class="badge bg-success" *ngIf="r.type==='attendance'">Attendance</span>
                  <span class="badge bg-warning" *ngIf="r.type==='voting'">Voting</span>
                  <span class="badge bg-secondary" *ngIf="r.type==='documents'">Documents</span>
                  <span class="badge bg-info" *ngIf="r.type==='custom'">Custom</span>
                </td>
                <td>{{ r.generatedAt | date:'MMM d, y' }}<br/><small class="text-muted">{{ r.generatedAt | date:'shortTime' }}</small></td>
                <td>{{ r.generatedBy }}</td>
                <td>
                  <div class="btn-group" role="group">
                    <button class="btn btn-sm btn-primary" (click)="viewReport(r.id)"><i class="fas fa-eye"></i></button>
                    <button class="btn btn-sm btn-success" (click)="downloadReport(r.id)"><i class="fas fa-download"></i></button>
                    <button class="btn btn-sm btn-outline-secondary" (click)="shareReport(r.id)"><i class="fas fa-share"></i></button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="!d.recent?.length">
                <td colspan="5" class="text-center text-muted">No reports generated yet.</td>
              </tr>
            </tbody>
          </table>

          <div *ngIf="loadError()" class="alert alert-danger mt-3">
            {{ loadError() }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal Component -->
<app-generate-report-modal (submitReport)="onGenerate($event)"></app-generate-report-modal>
